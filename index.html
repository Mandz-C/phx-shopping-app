<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INFINIX | BTL Material Management System</title>
    
    <!-- Add Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* COMPLETE CSS STYLES */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        :root {
            --dark-green: #11270B;
            --main-green: #71B340;
            --light-green: #669D31;
            --accent-green: #598B2C;
            --deep-green: #3C5A14;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
        }
        .header {
            background: linear-gradient(135deg, var(--dark-green) 0%, var(--deep-green) 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .header h1 {
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .logo {
            background: var(--main-green);
            color: white;
            padding: 8px 20px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 24px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }
        .section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h2 {
            color: var(--dark-green);
            border-bottom: 3px solid var(--main-green);
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 20px;
        }
        h3 {
            color: var(--deep-green);
            margin: 15px 0;
        }
        .tab-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .tab-btn {
            padding: 12px 24px;
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            cursor: pointer;
            border-radius: 8px;
            font-weight: bold;
            color: var(--dark-green);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .tab-btn:hover {
            background: var(--main-green);
            color: white;
            border-color: var(--light-green);
            transform: translateY(-2px);
        }
        .tab-btn.active {
            background: var(--main-green);
            color: white;
            border-color: var(--light-green);
            box-shadow: 0 3px 6px rgba(113, 179, 64, 0.3);
        }
        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .tab-content.active {
            display: block;
        }
        input, select, textarea {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s;
        }
        input:focus, select:focus, textarea:focus {
            border-color: var(--main-green);
            outline: none;
            box-shadow: 0 0 0 3px rgba(113, 179, 64, 0.2);
        }
        button {
            background: var(--main-green);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        button:hover {
            background: var(--light-green);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        button.cancel {
            background: #dc3545;
        }
        button.cancel:hover {
            background: #c82333;
        }
        button.success {
            background: var(--accent-green);
        }
        button.success:hover {
            background: var(--deep-green);
        }
        .item-card, .order-card, .category-card, .team-card {
            border: 2px solid #e9ecef;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            transition: all 0.3s;
        }
        .item-card:hover, .order-card:hover, .category-card:hover {
            border-color: var(--main-green);
            box-shadow: 0 4px 12px rgba(113, 179, 64, 0.2);
        }
        .category-tag {
            display: inline-block;
            background: linear-gradient(135deg, #e8f5e9 0%, #d4edda 100%);
            color: var(--dark-green);
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
            margin-right: 10px;
            margin-bottom: 10px;
            border: 1px solid #c3e6cb;
        }
        .status {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin: 5px;
            min-width: 100px;
            text-align: center;
        }
        .status.processing { 
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404; 
            border: 1px solid #ffeaa7;
        }
        .status.shipped { 
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            color: #0c5460; 
            border: 1px solid #bee5eb;
        }
        .status.delivered { 
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724; 
            border: 1px solid #c3e6cb;
        }
        .status.cancelled { 
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24; 
            border: 1px solid #f5c6cb;
        }
        .stock-indicator {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 15px;
            font-weight: bold;
            margin: 5px 0;
            font-size: 13px;
        }
        .stock-low { background: linear-gradient(135deg, #fde8e8 0%, #fbd5d5 100%); color: #c53030; }
        .stock-medium { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color: #d97706; }
        .stock-high { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); color: #065f46; }
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 2px solid #f0f0f0;
            background: #f8fafc;
            border-radius: 8px;
            margin: 10px 0;
        }
        .cart-total {
            text-align: right;
            font-size: 24px;
            font-weight: bold;
            color: var(--dark-green);
            margin: 20px 0;
            padding: 20px;
            background: #f8fafc;
            border-radius: 10px;
        }
        .order-id {
            background: var(--dark-green);
            color: white;
            padding: 8px 20px;
            border-radius: 6px;
            font-family: monospace;
            font-weight: bold;
            display: inline-block;
            margin: 5px 0;
            font-size: 18px;
            letter-spacing: 1px;
        }
        .category-select {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            background: #f8fafc;
            border-radius: 10px;
        }
        .category-select select {
            flex: 1;
        }
        .admin-key {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--dark-green) 0%, var(--deep-green) 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        .admin-key:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.3);
        }
        .admin-panel {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            z-index: 1001;
            width: 95%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .admin-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        .close-admin {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            font-weight: bold;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        .close-admin:hover {
            background: #c82333;
            transform: rotate(90deg);
        }
        .admin-section {
            margin: 25px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid var(--main-green);
        }
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
            flex-wrap: wrap;
        }
        .admin-tab-btn {
            padding: 10px 20px;
            background: #e9ecef;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            color: #495057;
            transition: all 0.3s;
        }
        .admin-tab-btn.active {
            background: var(--main-green);
            color: white;
        }
        .admin-tab-content {
            display: none;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }
        .admin-tab-content.active {
            display: block;
        }
        .banner-container {
            overflow: hidden;
            white-space: nowrap;
            background: linear-gradient(135deg, var(--main-green) 0%, var(--accent-green) 100%);
            padding: 15px 0;
            margin: 20px 0;
            border-radius: 10px;
            position: relative;
        }
        .banner-scroll {
            display: inline-block;
            animation: bannerScroll 30s linear infinite;
            color: white;
            font-weight: bold;
            font-size: 20px;
            padding: 0 20px;
        }
        @keyframes bannerScroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        .banner-scroll span {
            margin: 0 40px;
        }
        .home-hero {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, rgba(113, 179, 64, 0.1) 0%, rgba(102, 157, 49, 0.1) 100%);
            border-radius: 15px;
            margin-bottom: 30px;
        }
        .home-hero h2 {
            color: var(--dark-green);
            font-size: 32px;
            margin-bottom: 15px;
            border: none;
        }
        .home-hero p {
            color: var(--deep-green);
            font-size: 18px;
            max-width: 800px;
            margin: 0 auto 30px;
            line-height: 1.6;
        }
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-top: 5px solid var(--main-green);
        }
        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: var(--dark-green);
            margin: 10px 0;
        }
        .stat-label {
            color: var(--deep-green);
            font-size: 14px;
            font-weight: bold;
        }
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .team-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border: 2px solid #e9ecef;
        }
        .team-card h4 {
            color: var(--dark-green);
            margin-bottom: 10px;
        }
        .team-card .position {
            color: var(--main-green);
            font-weight: bold;
            margin-bottom: 10px;
        }
        .team-card .nickname {
            background: var(--light-green);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            display: inline-block;
            margin-top: 10px;
        }
        .checkout-form {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        /* SIMPLIFIED CHECKOUT TAB */
        .order-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #dee2e6;
        }
        .summary-total {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            font-size: 18px;
            font-weight: bold;
            color: var(--dark-green);
            border-top: 2px solid var(--main-green);
            margin-top: 10px;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            .tab-buttons {
                flex-direction: column;
            }
            .tab-btn {
                width: 100%;
                justify-content: center;
            }
            .quick-stats {
                grid-template-columns: 1fr;
            }
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: var(--main-green);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--light-green);
        }
        .share-link {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px dashed var(--main-green);
        }
        .order-tracking {
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
        }
        .tracking-input {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        .progress-tracker {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
            position: relative;
        }
        .progress-tracker::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 4px;
            background: #e9ecef;
            transform: translateY(-50%);
            z-index: 1;
        }
        .tracker-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }
        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #6c757d;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        .step-circle.active {
            background: var(--main-green);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(113, 179, 64, 0.3);
        }
        .step-label {
            font-size: 14px;
            color: #6c757d;
            text-align: center;
        }
        .step-label.active {
            color: var(--main-green);
            font-weight: bold;
        }
        
        /* Loading indicator */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--main-green);
        }
        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><span class="logo">INFINIX</span> | BTL Material Management System</h1>
        <p>Efficient Material Request & Tracking System</p>
    </div>

    <!-- Connection Status -->
    <div id="connectionStatus" style="display: none; background: #f8d7da; color: #721c24; padding: 10px; margin: 10px 0; border-radius: 5px; text-align: center;">
        <span id="statusText"></span>
    </div>

    <!-- BANNER -->
    <div class="banner-container">
        <div class="banner-scroll">
            <span>Together We Grow. Together We Win. Infinix 2026!</span>
            <span>BTL Material Management System</span>
            <span>Efficient ‚Ä¢ Organized ‚Ä¢ Professional</span>
        </div>
    </div>

    <!-- CUSTOMER TABS - FIXED: Added event parameter -->
    <div class="tab-buttons" id="customerTabs">
        <button class="tab-btn active" onclick="switchTab('home', event)">üè† Home</button>
        <button class="tab-btn" onclick="switchTab('store', event)">üõçÔ∏è Materials</button>
        <button class="tab-btn" onclick="switchTab('cart', event)">üõí Cart (<span id="cartCount">0</span>)</button>
        <button class="tab-btn" onclick="switchTab('checkout', event)">üìù Submit Request</button>
        <button class="tab-btn" onclick="switchTab('orders', event)">üì¶ My Requests</button>
        <button class="tab-btn" onclick="switchTab('track', event)">üìç Track Request</button>
        <button class="tab-btn" onclick="switchTab('about', event)">üë• About</button>
    </div>

    <!-- HOME TAB -->
    <div id="home-tab" class="tab-content active">
        <div class="section">
            <div class="home-hero">
                <h2>Welcome to the BTL Material Management System</h2>
                <p>Streamline your material requests with our efficient system. Request, track, and manage all your BTL materials in one place.</p>
                <button class="success" onclick="switchTab('store', event)">Browse Materials ‚Üí</button>
            </div>
            
            <h3>üìä System Overview</h3>
            <div class="quick-stats">
                <div class="stat-card">
                    <div class="stat-number" id="homeTotalProducts">0</div>
                    <div class="stat-label">Available Materials</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="homeTotalOrders">0</div>
                    <div class="stat-label">Total Requests</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="homeActiveOrders">0</div>
                    <div class="stat-label">Active Requests</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="homeDeliveredOrders">0</div>
                    <div class="stat-label">Completed</div>
                </div>
            </div>

            <h3>üöÄ Quick Actions</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 20px;">
                <button onclick="switchTab('store', event)">Browse Materials</button>
                <button onclick="switchTab('checkout', event)">Submit Request</button>
                <button onclick="switchTab('track', event)">Track Request</button>
                <button class="success" onclick="showAdminPanel()">Admin Panel</button>
            </div>
        </div>
    </div>

    <!-- STORE TAB -->
    <div id="store-tab" class="tab-content">
        <div class="section">
            <h2>üõçÔ∏è Available Materials</h2>
            <div class="category-select">
                <label for="categoryFilter" style="font-weight: bold; color: var(--dark-green);">Filter by Category:</label>
                <select id="categoryFilter" onchange="filterCategory(this.value)">
                    <option value="all">All Categories</option>
                </select>
            </div>
            <div id="storeItems">
                <div class="loading">Loading materials</div>
            </div>
        </div>
    </div>

    <!-- CART TAB -->
    <div id="cart-tab" class="tab-content">
        <div class="section">
            <h2>üõí Your Cart</h2>
            <div id="cartItems"></div>
            <div class="cart-total" id="cartTotal">Total Items: 0</div>
            <button class="success" onclick="switchTab('checkout', event)">‚úÖ Proceed to Submit Request</button>
            <button class="cancel" onclick="clearCart()">üóëÔ∏è Clear Cart</button>
        </div>
    </div>

    <!-- CHECKOUT TAB -->
    <div id="checkout-tab" class="tab-content">
        <div class="section">
            <h2>üìù Submit Material Request</h2>
            
            <div class="order-summary">
                <h3>üì¶ Items in Your Cart</h3>
                <div id="checkoutSummary"></div>
                <div class="summary-total" id="checkoutSummaryTotal">Total Items: 0</div>
            </div>
            
            <div class="checkout-form">
                <h3>üë§ Requester Information</h3>
                
                <div class="form-group">
                    <label>Requestor's Full Name *</label>
                    <input type="text" id="requestorName" placeholder="Enter your full name" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>User ID # *</label>
                        <input type="text" id="userId" placeholder="e.g., 12345" required>
                    </div>
                    <div class="form-group">
                        <label>Shop ID *</label>
                        <input type="text" id="shopId" placeholder="e.g., SHOP001" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Contact Number *</label>
                        <input type="tel" id="contactNumber" placeholder="e.g., 09171234567" required>
                    </div>
                    <div class="form-group">
                        <label>Store Status *</label>
                        <select id="storeStatus" required>
                            <option value="">Select Status</option>
                            <option value="New">New</option>
                            <option value="Existing">Existing</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Address *</label>
                    <textarea id="address" placeholder="Enter complete address" rows="3" required></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Region *</label>
                        <select id="region" required>
                            <option value="">Select Region</option>
                            <option value="NCR">NCR</option>
                            <option value="North Luzon">North Luzon</option>
                            <option value="Central Luzon">Central Luzon</option>
                            <option value="South Luzon">South Luzon</option>
                            <option value="Visayas">Visayas</option>
                            <option value="Mindanao">Mindanao</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Date Needed *</label>
                        <input type="date" id="dateNeeded" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Additional Notes (Optional)</label>
                    <textarea id="requestNotes" placeholder="Any additional information or special instructions..." rows="3"></textarea>
                </div>
                
                <div style="margin-top: 30px; text-align: center;">
                    <button class="success" onclick="submitRequest()" style="padding: 15px 40px; font-size: 18px;">
                        ‚úÖ Submit Material Request
                    </button>
                    <button class="cancel" onclick="switchTab('cart', event)">‚Üê Back to Cart</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ORDERS TAB -->
    <div id="orders-tab" class="tab-content">
        <div class="section">
            <h2>üì¶ My Material Requests</h2>
            <input type="text" id="orderSearch" placeholder="üîç Search by Request ID or Material" onkeyup="searchOrders()">
            <div id="customerOrders">
                <div class="loading">Loading requests</div>
            </div>
        </div>
    </div>

    <!-- TRACK ORDER TAB -->
    <div id="track-tab" class="tab-content">
        <div class="section">
            <h2>üìç Track Your Request</h2>
            <div class="order-tracking">
                <p>Enter your Request ID to track status:</p>
                <div class="tracking-input">
                    <input type="text" id="trackOrderId" placeholder="Enter Request ID (e.g., INFX00001)">
                    <button onclick="trackOrder()">üîç Track Request</button>
                </div>
                <div class="tracking-result" id="trackingResult" style="display: none;">
                    <div class="order-details" id="trackingDetails"></div>
                    <div class="progress-tracker" id="progressTracker">
                        <div class="tracker-step">
                            <div class="step-circle">1</div>
                            <div class="step-label">Request Submitted</div>
                        </div>
                        <div class="tracker-step">
                            <div class="step-circle">2</div>
                            <div class="step-label">Processing</div>
                        </div>
                        <div class="tracker-step">
                            <div class="step-circle">3</div>
                            <div class="step-label">Approved</div>
                        </div>
                        <div class="tracker-step">
                            <div class="step-circle">4</div>
                            <div class="step-label">Delivered</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ABOUT TAB -->
    <div id="about-tab" class="tab-content">
        <div class="section">
            <h2>üë• BTL Team</h2>
            <p style="margin-bottom: 20px; color: var(--deep-green);">Meet the team behind the BTL Material Management System</p>
            
            <div class="team-grid">
                <div class="team-card">
                    <h4>King Rey Calinawan Mateo</h4>
                    <div class="position">BTL Supervisor</div>
                    <div class="nickname">King</div>
                    <p style="margin-top: 15px; color: #666;">Oversees all BTL operations and material management.</p>
                </div>
                
                <div class="team-card">
                    <h4>Jover Cruz Pe√±a</h4>
                    <div class="position">BTL Specialist</div>
                    <div class="nickname">Ethan</div>
                    <p style="margin-top: 15px; color: #666;">Handles material coordination and deployment.</p>
                </div>
                
                <div class="team-card">
                    <h4>Armando Cristobal Jr</h4>
                    <div class="position">Data Analyst</div>
                    <p style="margin-top: 15px; color: #666;">Manages data analysis and system optimization.</p>
                </div>
            </div>

            <div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #e9ecef;">
                <h3>üì± Share This System</h3>
                <div class="share-link">
                    <p>Share this link with team members:</p>
                    <input type="text" id="storeLink" readonly>
                    <button onclick="copyStoreLink()">üìã Copy Link</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ADMIN PANEL -->
    <div class="admin-key" onclick="showAdminPanel()">
        <span>üîë</span>
        <span>Admin Panel</span>
    </div>
    
    <div class="admin-overlay" id="adminOverlay" onclick="hideAdminPanel()"></div>
    
    <div class="admin-panel" id="adminPanel">
        <button class="close-admin" onclick="hideAdminPanel()">√ó</button>
        <h2>üîê Admin Dashboard</h2>
        
        <div style="margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 10px;">
            <label style="display: block; margin-bottom: 10px; font-weight: bold;">Admin Password:</label>
            <div style="display: flex; gap: 10px;">
                <input type="password" id="adminPassword" placeholder="Enter admin password" style="flex: 1;">
                <button onclick="verifyAdmin()">üîì Access Panel</button>
            </div>
        </div>
        
        <div id="adminContent" style="display: none;">
            <!-- ADMIN TABS - FIXED: Added event parameter -->
            <div class="admin-tabs">
                <button class="admin-tab-btn active" onclick="switchAdminTab('items', event)">üì¶ Materials</button>
                <button class="admin-tab-btn" onclick="switchAdminTab('categories', event)">üè∑Ô∏è Categories</button>
                <button class="admin-tab-btn" onclick="switchAdminTab('orders', event)">üìã Requests</button>
                <button class="admin-tab-btn" onclick="switchAdminTab('export', event)">üìä Export</button>
            </div>
            
            <!-- ITEMS TAB -->
            <div id="admin-items-tab" class="admin-tab-content active">
                <div class="admin-section">
                    <h3>‚ûï Add New Material</h3>
                    <input type="text" id="itemName" placeholder="Material Name *" required>
                    <select id="itemCategory" required>
                        <option value="">Select Category *</option>
                    </select>
                    <input type="number" id="itemStock" placeholder="Initial Stock *" required>
                    <textarea id="itemDesc" placeholder="Description (Optional)" rows="3"></textarea>
                    <button class="success" onclick="addItem()">‚ûï Add Material</button>
                </div>
                
                <div class="admin-section">
                    <h3>üì¶ Manage Stock</h3>
                    <div id="stockList">
                        <div class="loading">Loading materials</div>
                    </div>
                </div>
            </div>
            
            <!-- CATEGORIES TAB -->
            <div id="admin-categories-tab" class="admin-tab-content">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="admin-section">
                        <h3>üè∑Ô∏è Add New Category</h3>
                        <input type="text" id="newCategoryName" placeholder="Category Name *" required>
                        <button class="success" onclick="addCategory()">‚ûï Add Category</button>
                    </div>
                    
                    <div class="admin-section">
                        <h3>üìã Manage Categories</h3>
                        <div id="categoryList">
                            <div class="loading">Loading categories</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ORDERS TAB -->
            <div id="admin-orders-tab" class="admin-tab-content">
                <div class="admin-section">
                    <h3>üìã All Material Requests</h3>
                    <div style="margin-bottom: 20px;">
                        <input type="text" id="adminOrderSearch" placeholder="Search requests..." onkeyup="searchAdminOrders()">
                    </div>
                    <div id="orderList">
                        <div class="loading">Loading requests</div>
                    </div>
                </div>
            </div>
            
            <!-- EXPORT TAB -->
            <div id="admin-export-tab" class="admin-tab-content">
                <div class="admin-section">
                    <h3>üìä Export Data</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <button onclick="exportToExcel('orders')" style="padding: 20px; text-align: center;">
                            üìã Export Requests<br>
                            <small>All request data</small>
                        </button>
                        <button onclick="exportToExcel('items')" style="padding: 20px; text-align: center;">
                            üì¶ Export Materials<br>
                            <small>Material inventory</small>
                        </button>
                        <button onclick="backupData()" style="padding: 20px; text-align: center;">
                            üíæ Backup Data<br>
                            <small>Full system backup</small>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==============================================
        // SUPABASE CONFIGURATION
        // ==============================================
        const SUPABASE_URL = 'https://qmmxtglgizvqilmzneqn.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFtbXh0Z2xnaXp2cWlsbXpuZXFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3NTgwMTksImV4cCI6MjA4MDMzNDAxOX0.fpogdv4U0pbWKUPKIUTigIxtannvWOwdY6PnJtebudU';
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // ==============================================
        // DATA STORAGE
        // ==============================================
        let items = [];
        let cart = JSON.parse(localStorage.getItem('infxCart')) || [];
        let categories = [];
        let orders = [];
        let orderCounter = 1;
        const ADMIN_PASSWORD = "INFINIXBTL123";

        // ==============================================
        // TAB SWITCHING FUNCTIONS - FIXED VERSION
        // ==============================================

        // FIXED: switchTab function with event parameter
        function switchTab(tabName, event) {
            // Remove active class from all tab buttons
            document.querySelectorAll('#customerTabs .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // FIX: Check if event exists before using event.target
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // If no event (programmatic call), find the correct button
                const buttons = document.querySelectorAll('#customerTabs .tab-btn');
                buttons.forEach(btn => {
                    const btnText = btn.textContent.toLowerCase();
                    if (btnText.includes(tabName.toLowerCase())) {
                        btn.classList.add('active');
                    }
                });
            }
            
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Show the selected tab
            const tabElement = document.getElementById(tabName + '-tab');
            if (tabElement) {
                tabElement.classList.add('active');
            }
            
            // Load content for specific tabs
            if(tabName === 'store') {
                displayStoreItems();
            } else if(tabName === 'cart') {
                displayCart();
            } else if(tabName === 'orders') {
                displayCustomerOrders();
            } else if(tabName === 'home') {
                updateHomeStats();
            } else if(tabName === 'about') {
                updateStoreLink();
            } else if(tabName === 'track') {
                document.getElementById('trackingResult').style.display = 'none';
            } else if(tabName === 'checkout') {
                displayCheckoutSummary();
                // Set min date to tomorrow
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                document.getElementById('dateNeeded').min = tomorrow.toISOString().split('T')[0];
            }
        }

        // FIXED: switchAdminTab function with event parameter
        function switchAdminTab(tabName, event) {
            // Remove active class from all admin tab buttons
            document.querySelectorAll('.admin-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // FIX: Check if event exists
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // Find and activate the correct button
                const buttons = document.querySelectorAll('.admin-tab-btn');
                buttons.forEach(btn => {
                    if (btn.textContent.toLowerCase().includes(tabName.toLowerCase())) {
                        btn.classList.add('active');
                    }
                });
            }
            
            // Hide all admin tab contents
            document.querySelectorAll('.admin-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Show the selected admin tab
            document.getElementById('admin-' + tabName + '-tab').classList.add('active');
        }

        // ==============================================
        // SUPABASE FUNCTIONS
        // ==============================================

        async function loadItemsFromSupabase() {
            try {
                const { data, error } = await supabase
                    .from('items')
                    .select('*')
                    .order('name');
                
                if (error) throw error;
                items = data || [];
                return items;
            } catch (error) {
                console.error('Error loading items:', error);
                return getLocalItems();
            }
        }

        async function loadCategoriesFromSupabase() {
            try {
                const { data, error } = await supabase
                    .from('categories')
                    .select('*')
                    .order('name');
                
                if (error) throw error;
                categories = data.map(cat => cat.name) || [];
                return categories;
            } catch (error) {
                console.error('Error loading categories:', error);
                return getLocalCategories();
            }
        }

        async function loadOrdersFromSupabase() {
            try {
                const { data, error } = await supabase
                    .from('orders')
                    .select(`
                        *,
                        order_items (*)
                    `)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                orders = (data || []).map(order => ({
                    id: order.order_id,
                    requestorName: order.requestor_name,
                    userId: order.user_id,
                    shopId: order.shop_id,
                    contactNumber: order.contact_number,
                    address: order.address,
                    storeStatus: order.store_status,
                    region: order.region,
                    dateNeeded: order.date_needed,
                    notes: order.notes,
                    status: order.status,
                    date: new Date(order.created_at).toLocaleString(),
                    items: order.order_items ? order.order_items.map(oi => ({
                        itemId: oi.item_id,
                        name: oi.item_name,
                        quantity: oi.quantity
                    })) : [],
                    orderNumber: parseInt(order.order_id.replace('INFX', ''))
                }));
                
                return orders;
            } catch (error) {
                console.error('Error loading orders:', error);
                return getLocalOrders();
            }
        }

        async function getNextOrderId() {
            try {
                const { data: counterData, error: counterError } = await supabase
                    .from('system_counters')
                    .select('value')
                    .eq('name', 'order_counter')
                    .single();
                
                if (counterError) throw counterError;
                
                const currentValue = counterData.value;
                const orderId = 'INFX' + currentValue.toString().padStart(5, '0');
                
                const { error: updateError } = await supabase
                    .from('system_counters')
                    .update({ value: currentValue + 1 })
                    .eq('name', 'order_counter');
                
                if (updateError) throw updateError;
                
                return orderId;
            } catch (error) {
                console.error('Error getting order ID:', error);
                const orderId = 'INFX' + orderCounter.toString().padStart(5, '0');
                orderCounter++;
                localStorage.setItem('infxOrderCounter', orderCounter.toString());
                return orderId;
            }
        }

        // ==============================================
        // SUBMIT REQUEST FUNCTION - FIXED VERSION
        // ==============================================

        async function submitRequest() {
            if(cart.length === 0) {
                alert('Your cart is empty! Please add materials first.');
                switchTab('store', null);
                return;
            }
            
            const requestorName = document.getElementById('requestorName').value.trim();
            const userId = document.getElementById('userId').value.trim();
            const shopId = document.getElementById('shopId').value.trim();
            const contactNumber = document.getElementById('contactNumber').value.trim();
            const address = document.getElementById('address').value.trim();
            const storeStatus = document.getElementById('storeStatus').value;
            const region = document.getElementById('region').value;
            const dateNeeded = document.getElementById('dateNeeded').value;
            const notes = document.getElementById('requestNotes').value.trim();
            
            if(!requestorName || !userId || !shopId || !contactNumber || !address || !storeStatus || !region || !dateNeeded) {
                alert('Please fill all required fields!');
                return;
            }
            
            // Show loading
            const submitBtn = document.querySelector('button[onclick="submitRequest()"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '‚è≥ Submitting...';
            submitBtn.disabled = true;
            
            try {
                // Get order ID
                const orderId = await getNextOrderId();
                
                const orderData = {
                    id: orderId,
                    requestorName: requestorName,
                    userId: userId,
                    shopId: shopId,
                    contactNumber: contactNumber,
                    address: address,
                    storeStatus: storeStatus,
                    region: region,
                    dateNeeded: dateNeeded,
                    notes: notes,
                    date: new Date().toLocaleString(),
                    items: [...cart],
                    status: 'processing'
                };
                
                // Try to submit to Supabase
                let supabaseSuccess = false;
                let supabaseError = null;
                
                try {
                    // 1. Test Supabase connection first
                    const { data: testData, error: testError } = await supabase
                        .from('orders')
                        .select('count')
                        .limit(1);
                        
                    if (testError) throw testError;
                    
                    // 2. Submit order to Supabase
                    const { data: order, error: orderError } = await supabase
                        .from('orders')
                        .insert([{
                            order_id: orderData.id,
                            requestor_name: orderData.requestorName,
                            user_id: orderData.userId,
                            shop_id: orderData.shopId,
                            contact_number: orderData.contactNumber,
                            address: orderData.address,
                            store_status: orderData.storeStatus,
                            region: orderData.region,
                            date_needed: orderData.dateNeeded,
                            notes: orderData.notes,
                            status: orderData.status
                        }])
                        .select()
                        .single();
                    
                    if (orderError) throw orderError;
                    
                    // 3. Insert order items
                    const orderItems = orderData.items.map(item => ({
                        order_id: orderData.id,
                        item_id: item.itemId,
                        item_name: item.name,
                        quantity: item.quantity
                    }));
                    
                    const { error: itemsError } = await supabase
                        .from('order_items')
                        .insert(orderItems);
                    
                    if (itemsError) throw itemsError;
                    
                    supabaseSuccess = true;
                    
                } catch (supabaseErr) {
                    console.error('Supabase submission error:', supabaseErr);
                    supabaseError = supabaseErr.message;
                    supabaseSuccess = false;
                }
                
                // Always save locally (as backup)
                orders.push(orderData);
                saveLocalData();
                
                // Clear cart
                cart = [];
                localStorage.setItem('infxCart', JSON.stringify(cart));
                
                // Update UI
                displayCart();
                updateCartCount();
                displayCustomerOrders();
                displayStoreItems();
                
                // Clear form
                document.getElementById('requestorName').value = '';
                document.getElementById('userId').value = '';
                document.getElementById('shopId').value = '';
                document.getElementById('contactNumber').value = '';
                document.getElementById('address').value = '';
                document.getElementById('storeStatus').value = '';
                document.getElementById('region').value = '';
                document.getElementById('dateNeeded').value = '';
                document.getElementById('requestNotes').value = '';
                
                // Show appropriate success message
                if (supabaseSuccess) {
                    alert(`‚úÖ Material Request Submitted Successfully!\n\nRequest ID: ${orderId}\nName: ${requestorName}\nShop: ${shopId}\n\n‚úÖ Saved to database and locally!`);
                } else {
                    alert(`‚ö†Ô∏è Request saved locally (offline mode)\n\nRequest ID: ${orderId}\nName: ${requestorName}\nShop: ${shopId}\n\nReason: ${supabaseError || 'Network error'}\n\nData will sync when connection is restored.`);
                }
                
                // FIXED: Call switchTab without event parameter
                switchTab('orders', null);
                
            } catch (error) {
                console.error('General submission error:', error);
                alert(`‚ùå Error: ${error.message}\n\nPlease try again or contact support.`);
            } finally {
                // Restore button
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        // ==============================================
        // UI FUNCTIONS
        // ==============================================

        function initializeCategoryDropdown() {
            const select = document.getElementById('itemCategory');
            const filterSelect = document.getElementById('categoryFilter');
            
            select.innerHTML = '<option value="">Select Category *</option>';
            filterSelect.innerHTML = '<option value="all">All Categories</option>';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                select.appendChild(option.cloneNode(true));
                
                const filterOption = document.createElement('option');
                filterOption.value = category;
                filterOption.textContent = category;
                filterSelect.appendChild(filterOption);
            });
        }

        function displayStoreItems() {
            const storeItems = document.getElementById('storeItems');
            storeItems.innerHTML = '';
            
            const categoryFilter = document.getElementById('categoryFilter').value;
            let filteredItems = categoryFilter === 'all' ? items : items.filter(item => item.category === categoryFilter);
            
            if(filteredItems.length === 0) {
                storeItems.innerHTML = '<p style="text-align: center; padding: 40px; color: #666;">No materials available in this category.</p>';
                return;
            }
            
            filteredItems.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item-card';
                
                let stockClass = 'stock-high', stockText = 'In Stock';
                if(item.stock <= 0) {
                    stockClass = 'stock-low';
                    stockText = 'Out of Stock';
                } else if(item.stock < 10) {
                    stockClass = 'stock-medium';
                    stockText = 'Low Stock';
                }
                
                itemDiv.innerHTML = `
                    <h4>${item.name}</h4>
                    ${item.description ? `<p>${item.description}</p>` : ''}
                    <div>
                        <span class="category-tag">${item.category}</span>
                        <span class="stock-indicator ${stockClass}">${stockText}: ${item.stock}</span>
                    </div>
                    <div style="margin-top: 15px;">
                        <input type="number" id="qty-${item.id}" min="1" max="${item.stock}" value="1" style="width: 80px; display: inline-block; margin-right: 10px;">
                        <button onclick="addToCart(${item.id})" ${item.stock === 0 ? 'disabled' : ''}>
                            ${item.stock === 0 ? 'Out of Stock' : 'üõí Add to Cart'}
                        </button>
                    </div>
                `;
                storeItems.appendChild(itemDiv);
            });
        }

        function addToCart(itemId) {
            const item = items.find(i => i.id == itemId);
            const quantity = parseInt(document.getElementById(`qty-${itemId}`).value) || 1;
            
            if(item && item.stock >= quantity) {
                const cartItem = cart.find(ci => ci.itemId == itemId);
                
                if(cartItem) {
                    cartItem.quantity += quantity;
                } else {
                    cart.push({
                        itemId: item.id,
                        name: item.name,
                        category: item.category,
                        quantity: quantity
                    });
                }
                
                item.stock -= quantity;
                saveLocalData();
                displayStoreItems();
                updateCartCount();
                alert(`Added ${quantity} √ó ${item.name} to cart!`);
                document.getElementById(`qty-${itemId}`).value = 1;
            } else {
                alert('Not enough stock available!');
            }
        }

        function updateCartCount() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartCount').textContent = totalItems;
        }

        function displayCart() {
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            
            cartItems.innerHTML = '';
            
            if(cart.length === 0) {
                cartItems.innerHTML = '<p style="text-align: center; padding: 40px; color: #666;">Your cart is empty.<br>Browse materials to add items!</p>';
                cartTotal.textContent = 'Total Items: 0';
                return;
            }
            
            cart.forEach((cartItem, index) => {
                const cartItemDiv = document.createElement('div');
                cartItemDiv.className = 'cart-item';
                cartItemDiv.innerHTML = `
                    <div>
                        <strong>${cartItem.name}</strong><br>
                        <span class="category-tag">${cartItem.category}</span>
                        <div>Quantity: ${cartItem.quantity}</div>
                    </div>
                    <div>
                        <button onclick="updateCartQuantity(${index}, ${cartItem.quantity - 1})">‚ûñ</button>
                        <button onclick="updateCartQuantity(${index}, ${cartItem.quantity + 1})">‚ûï</button>
                        <button class="cancel" onclick="removeFromCart(${index})">üóëÔ∏è</button>
                    </div>
                `;
                cartItems.appendChild(cartItemDiv);
            });
            
            cartTotal.textContent = `Total Items: ${cart.reduce((sum, item) => sum + item.quantity, 0)}`;
        }

        function updateCartQuantity(index, newQuantity) {
            const cartItem = cart[index];
            const item = items.find(i => i.id == cartItem.itemId);
            
            if(item && newQuantity > 0) {
                const stockChange = newQuantity - cartItem.quantity;
                
                if(item.stock >= stockChange) {
                    cartItem.quantity = newQuantity;
                    item.stock -= stockChange;
                    saveLocalData();
                    displayCart();
                    displayStoreItems();
                    updateCartCount();
                    displayCheckoutSummary();
                } else {
                    alert('Not enough stock available!');
                }
            } else if(newQuantity <= 0) {
                removeFromCart(index);
            }
        }

        function removeFromCart(index) {
            const cartItem = cart[index];
            const item = items.find(i => i.id == cartItem.itemId);
            
            if(item) {
                item.stock += cartItem.quantity;
                cart.splice(index, 1);
                saveLocalData();
                displayCart();
                displayStoreItems();
                updateCartCount();
                displayCheckoutSummary();
            }
        }

        function clearCart() {
            if(cart.length === 0) return;
            
            if(confirm('Clear your cart?')) {
                cart.forEach(cartItem => {
                    const item = items.find(i => i.id == cartItem.itemId);
                    if(item) item.stock += cartItem.quantity;
                });
                
                cart = [];
                saveLocalData();
                displayCart();
                displayStoreItems();
                updateCartCount();
                displayCheckoutSummary();
            }
        }

        function displayCheckoutSummary() {
            const checkoutSummary = document.getElementById('checkoutSummary');
            const checkoutSummaryTotal = document.getElementById('checkoutSummaryTotal');
            
            checkoutSummary.innerHTML = '';
            
            if(cart.length === 0) {
                checkoutSummary.innerHTML = '<p style="text-align: center; padding: 20px; color: #666;">Your cart is empty. Add materials first.</p>';
                checkoutSummaryTotal.textContent = 'Total Items: 0';
                return;
            }
            
            cart.forEach(item => {
                const summaryDiv = document.createElement('div');
                summaryDiv.className = 'summary-item';
                summaryDiv.innerHTML = `
                    <span>${item.name}</span>
                    <span>√ó ${item.quantity}</span>
                `;
                checkoutSummary.appendChild(summaryDiv);
            });
            
            checkoutSummaryTotal.textContent = `Total Items: ${cart.reduce((sum, item) => sum + item.quantity, 0)}`;
        }

        function displayCustomerOrders() {
            const customerOrders = document.getElementById('customerOrders');
            customerOrders.innerHTML = '';
            
            if(orders.length === 0) {
                customerOrders.innerHTML = '<p style="text-align: center; padding: 40px; color: #666;">No requests yet.<br>Your requests will appear here!</p>';
                return;
            }
            
            const sortedOrders = [...orders].sort((a, b) => b.orderNumber - a.orderNumber);
            
            sortedOrders.forEach(order => {
                const orderDiv = document.createElement('div');
                orderDiv.className = 'order-card';
                orderDiv.innerHTML = `
                    <div class="order-id">${order.id}</div>
                    <p><strong>Requestor:</strong> ${order.requestorName} (ID: ${order.userId})</p>
                    <p><strong>Shop:</strong> ${order.shopId} ‚Ä¢ ${order.storeStatus} ‚Ä¢ ${order.region}</p>
                    <p><strong>Contact:</strong> ${order.contactNumber}</p>
                    <p><strong>Address:</strong> ${order.address}</p>
                    <p><strong>Date Needed:</strong> ${order.dateNeeded}</p>
                    <p><strong>Date Requested:</strong> ${order.date}</p>
                    <p><strong>Materials:</strong> ${order.items.map(item => `${item.name} √ó ${item.quantity}`).join(', ')}</p>
                    <p><strong>Status:</strong> <span class="status ${order.status}">${order.status.toUpperCase()}</span></p>
                    ${order.notes ? `<p><strong>Notes:</strong> ${order.notes}</p>` : ''}
                    <button onclick="viewOrderDetails('${order.id}')">üìã View Details</button>
                    <button onclick="trackSpecificOrder('${order.id}')">üìç Track Request</button>
                    ${order.status === 'processing' ? `<button class="cancel" onclick="cancelOrder('${order.id}')">‚ùå Cancel Request</button>` : ''}
                `;
                customerOrders.appendChild(orderDiv);
            });
        }

        function viewOrderDetails(orderId) {
            const order = orders.find(o => o.id === orderId);
            if(order) {
                alert(`üìã REQUEST DETAILS\n
Request ID: ${order.id}
Requestor: ${order.requestorName}
User ID: ${order.userId}
Shop ID: ${order.shopId}
Contact Number: ${order.contactNumber}
Address: ${order.address}
Store Status: ${order.storeStatus}
Region: ${order.region}
Date Needed: ${order.dateNeeded}
Request Date: ${order.date}
Status: ${order.status.toUpperCase()}
${order.notes ? `Notes: ${order.notes}\n` : ''}
MATERIALS:
${order.items.map(item => `  ‚Ä¢ ${item.name} x${item.quantity}`).join('\n')}

Total Items: ${order.items.reduce((sum, item) => sum + item.quantity, 0)}`);
            }
        }

        function trackSpecificOrder(orderId) {
            switchTab('track', null);
            document.getElementById('trackOrderId').value = orderId;
            setTimeout(() => trackOrder(), 100);
        }

        function trackOrder() {
            const orderId = document.getElementById('trackOrderId').value.trim().toUpperCase();
            const resultDiv = document.getElementById('trackingResult');
            const detailsDiv = document.getElementById('trackingDetails');
            
            if(!orderId) {
                alert('Please enter a Request ID');
                return;
            }
            
            const order = orders.find(o => o.id === orderId);
            
            if(!order) {
                detailsDiv.innerHTML = `
                    <div style="text-align: center; color: #dc3545; padding: 20px;">
                        <h3>‚ùå Request Not Found</h3>
                        <p>Request ID "${orderId}" was not found.</p>
                    </div>
                `;
                resultDiv.style.display = 'block';
                return;
            }
            
            // Update progress tracker
            const steps = document.querySelectorAll('.tracker-step');
            const statusIndex = {
                'processing': 1,
                'shipped': 2,
                'delivered': 3,
                'cancelled': -1
            };
            
            steps.forEach((step, index) => {
                const circle = step.querySelector('.step-circle');
                const label = step.querySelector('.step-label');
                
                if(index <= statusIndex[order.status]) {
                    circle.classList.add('active');
                    label.classList.add('active');
                } else {
                    circle.classList.remove('active');
                    label.classList.remove('active');
                }
            });
            
            if(order.status === 'cancelled') {
                steps.forEach(step => {
                    step.querySelector('.step-circle').classList.remove('active');
                    step.querySelector('.step-label').classList.remove('active');
                });
            }
            
            detailsDiv.innerHTML = `
                <h3>üì¶ Request Tracking: ${order.id}</h3>
                <p><strong>Requestor:</strong> ${order.requestorName}</p>
                <p><strong>Shop ID:</strong> ${order.shopId} (${order.storeStatus}, ${order.region})</p>
                <p><strong>Contact:</strong> ${order.contactNumber}</p>
                <p><strong>Address:</strong> ${order.address}</p>
                <p><strong>Date Needed:</strong> ${order.dateNeeded}</p>
                <p><strong>Request Date:</strong> ${order.date}</p>
                <p><strong>Current Status:</strong> <span class="status ${order.status}">${order.status.toUpperCase()}</span></p>
                <p><strong>Materials:</strong> ${order.items.map(item => `${item.name} √ó ${item.quantity}`).join(', ')}</p>
                ${order.notes ? `<p><strong>Notes:</strong> ${order.notes}</p>` : ''}
                ${order.status === 'cancelled' ? 
                    '<div style="background: #fde8e8; padding: 15px; border-radius: 8px; margin-top: 15px;"><strong>‚ö†Ô∏è This request has been cancelled.</strong></div>' : ''}
            `;
            
            resultDiv.style.display = 'block';
        }

        function cancelOrder(orderId) {
            if(confirm('Are you sure you want to cancel this request?')) {
                const order = orders.find(o => o.id === orderId);
                if(order && order.status === 'processing') {
                    order.status = 'cancelled';
                    order.items.forEach(orderItem => {
                        const item = items.find(i => i.id == orderItem.itemId);
                        if(item) item.stock += orderItem.quantity;
                    });
                    
                    saveLocalData();
                    displayCustomerOrders();
                    displayStoreItems();
                    alert('Request cancelled successfully.');
                }
            }
        }

        function searchOrders() {
            const searchTerm = document.getElementById('orderSearch').value.toLowerCase();
            const orderDivs = document.querySelectorAll('#customerOrders .order-card');
            
            orderDivs.forEach(div => {
                const text = div.textContent.toLowerCase();
                div.style.display = text.includes(searchTerm) ? 'block' : 'none';
            });
        }

        function updateHomeStats() {
            document.getElementById('homeTotalProducts').textContent = items.length;
            document.getElementById('homeTotalOrders').textContent = orders.length;
            document.getElementById('homeActiveOrders').textContent = orders.filter(o => o.status === 'processing' || o.status === 'shipped').length;
            document.getElementById('homeDeliveredOrders').textContent = orders.filter(o => o.status === 'delivered').length;
        }

        function filterCategory(category) {
            displayStoreItems();
        }

        // ==============================================
        // ADMIN FUNCTIONS
        // ==============================================

        function showAdminPanel() {
            document.getElementById('adminOverlay').style.display = 'block';
            document.getElementById('adminPanel').style.display = 'block';
        }

        function hideAdminPanel() {
            document.getElementById('adminOverlay').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('adminContent').style.display = 'none';
            document.getElementById('adminPassword').value = '';
        }

        function verifyAdmin() {
            const password = document.getElementById('adminPassword').value;
            if(password === ADMIN_PASSWORD) {
                document.getElementById('adminContent').style.display = 'block';
                displayItemsAdmin();
                displayOrdersAdmin();
                displayCategoriesAdmin();
                document.getElementById('adminPassword').value = '';
            } else {
                alert('Incorrect password!');
            }
        }

        async function addItem() {
            const name = document.getElementById('itemName').value.trim();
            const category = document.getElementById('itemCategory').value;
            const stock = parseInt(document.getElementById('itemStock').value);
            const desc = document.getElementById('itemDesc').value.trim();
            
            if(!name || !category || isNaN(stock) || stock < 0) {
                alert('Please fill all required fields correctly!');
                return;
            }
            
            try {
                const { data, error } = await supabase
                    .from('items')
                    .insert([{
                        name: name,
                        category: category,
                        stock: stock,
                        description: desc
                    }])
                    .select()
                    .single();
                
                if (error) throw error;
                
                items.push({
                    id: data.id,
                    name: data.name,
                    category: data.category,
                    stock: data.stock,
                    description: data.description
                });
                
                saveLocalData();
                displayItemsAdmin();
                displayStoreItems();
                
                document.getElementById('itemName').value = '';
                document.getElementById('itemCategory').value = '';
                document.getElementById('itemStock').value = '';
                document.getElementById('itemDesc').value = '';
                
                alert('Material added successfully to database!');
            } catch (error) {
                console.error('Error adding item:', error);
                alert('Error adding material to database. Added locally instead.');
                
                const newItem = {
                    id: Date.now(),
                    name: name,
                    category: category,
                    stock: stock,
                    description: desc,
                    dateAdded: new Date().toLocaleDateString()
                };
                
                items.push(newItem);
                saveLocalData();
                displayItemsAdmin();
                displayStoreItems();
                
                document.getElementById('itemName').value = '';
                document.getElementById('itemCategory').value = '';
                document.getElementById('itemStock').value = '';
                document.getElementById('itemDesc').value = '';
                
                alert('Material added to local storage!');
            }
        }

        function displayItemsAdmin() {
            const stockList = document.getElementById('stockList');
            stockList.innerHTML = '';
            
            items.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item-card';
                itemDiv.innerHTML = `
                    <h4>${item.name} <span class="category-tag">${item.category}</span></h4>
                    ${item.description ? `<p>${item.description}</p>` : ''}
                    <p>Stock: <span class="${item.stock < 10 ? 'stock-low' : 'stock-high'}">${item.stock} units</span></p>
                    <div style="margin-top: 15px;">
                        <select id="cat-${item.id}" style="width: auto; margin-right: 10px;">
                            ${categories.map(cat => 
                                `<option value="${cat}" ${item.category === cat ? 'selected' : ''}>${cat}</option>`
                            ).join('')}
                        </select>
                        <button onclick="updateItemCategory(${item.id})">Update Category</button>
                    </div>
                    <div style="margin-top: 10px;">
                        <button onclick="updateStock(${item.id}, 10)">+10</button>
                        <button onclick="updateStock(${item.id}, 5)">+5</button>
                        <button onclick="updateStock(${item.id}, -1)">-1</button>
                        <button onclick="updateStock(${item.id}, -5)">-5</button>
                        <button class="cancel" onclick="deleteItem(${item.id})">Delete Material</button>
                    </div>
                `;
                stockList.appendChild(itemDiv);
            });
        }

        async function updateItemCategory(itemId) {
            const item = items.find(i => i.id == itemId);
            if(item) {
                const select = document.getElementById(`cat-${itemId}`);
                const newCategory = select.value;
                
                item.category = newCategory;
                
                try {
                    const { error } = await supabase
                        .from('items')
                        .update({ category: newCategory })
                        .eq('id', itemId);
                    
                    if (error) throw error;
                    
                    saveLocalData();
                    displayItemsAdmin();
                    displayStoreItems();
                    
                    alert(`Category updated to "${newCategory}"`);
                } catch (error) {
                    console.error('Error updating category:', error);
                    saveLocalData();
                    displayItemsAdmin();
                    displayStoreItems();
                    alert('Category updated locally!');
                }
            }
        }

        async function updateStock(itemId, change) {
            const item = items.find(i => i.id == itemId);
            if(item) {
                const newStock = item.stock + change;
                if(newStock >= 0) {
                    item.stock = newStock;
                    
                    try {
                        const { error } = await supabase
                            .from('items')
                            .update({ stock: newStock })
                            .eq('id', itemId);
                        
                        if (error) throw error;
                    } catch (error) {
                        console.error('Error updating stock:', error);
                    }
                    
                    saveLocalData();
                    displayItemsAdmin();
                    displayStoreItems();
                }
            }
        }

        function deleteItem(itemId) {
            if(confirm('Delete this material?')) {
                items = items.filter(item => item.id != itemId);
                saveLocalData();
                displayItemsAdmin();
                displayStoreItems();
            }
        }

        async function addCategory() {
            const categoryName = document.getElementById('newCategoryName').value.trim();
            
            if(!categoryName) {
                alert('Please enter a category name');
                return;
            }
            
            if(categories.includes(categoryName)) {
                alert('Category already exists!');
                return;
            }
            
            try {
                const { data, error } = await supabase
                    .from('categories')
                    .insert([{ name: categoryName }])
                    .select()
                    .single();
                
                if (error) throw error;
                
                categories.push(categoryName);
                saveLocalData();
                displayCategoriesAdmin();
                initializeCategoryDropdown();
                
                document.getElementById('newCategoryName').value = '';
                alert(`Category "${categoryName}" added successfully to database!`);
            } catch (error) {
                console.error('Error adding category:', error);
                alert('Error adding category to database. Added locally instead.');
                
                categories.push(categoryName);
                saveLocalData();
                displayCategoriesAdmin();
                initializeCategoryDropdown();
                
                document.getElementById('newCategoryName').value = '';
                alert(`Category "${categoryName}" added to local storage!`);
            }
        }

        function displayCategoriesAdmin() {
            const categoryList = document.getElementById('categoryList');
            categoryList.innerHTML = '';
            
            if(categories.length === 0) {
                categoryList.innerHTML = '<p>No categories yet. Add your first category!</p>';
                return;
            }
            
            categories.forEach((category, index) => {
                const itemCount = items.filter(item => item.category === category).length;
                
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category-item';
                categoryDiv.innerHTML = `
                    <div>
                        <div class="category-name">${category}</div>
                        <div class="category-count">${itemCount} items</div>
                    </div>
                    <div>
                        <button onclick="editCategory(${index})">‚úèÔ∏è Edit</button>
                        <button class="cancel" onclick="deleteCategory(${index})">üóëÔ∏è Delete</button>
                    </div>
                `;
                categoryList.appendChild(categoryDiv);
            });
        }

        function editCategory(index) {
            const oldName = categories[index];
            const newName = prompt('Enter new category name:', oldName);
            
            if(!newName || newName.trim() === '') {
                alert('Category name cannot be empty!');
                return;
            }
            
            if(newName === oldName) return;
            
            if(categories.includes(newName)) {
                alert('Category already exists!');
                return;
            }
            
            items.forEach(item => {
                if(item.category === oldName) {
                    item.category = newName;
                }
            });
            
            categories[index] = newName;
            saveLocalData();
            displayCategoriesAdmin();
            initializeCategoryDropdown();
            displayStoreItems();
            displayItemsAdmin();
            
            alert(`Category updated from "${oldName}" to "${newName}"`);
        }

        function deleteCategory(index) {
            const categoryName = categories[index];
            const itemCount = items.filter(item => item.category === categoryName).length;
            
            if(!confirm(`Delete category "${categoryName}"?`)) {
                return;
            }
            
            categories.splice(index, 1);
            
            saveLocalData();
            displayCategoriesAdmin();
            initializeCategoryDropdown();
            displayStoreItems();
            displayItemsAdmin();
            
            alert(`Category "${categoryName}" deleted.`);
        }

        function displayOrdersAdmin() {
            const orderList = document.getElementById('orderList');
            orderList.innerHTML = '';
            
            if(orders.length === 0) {
                orderList.innerHTML = '<p>No requests yet.</p>';
                return;
            }
            
            const sortedOrders = [...orders].sort((a, b) => b.orderNumber - a.orderNumber);
            
            sortedOrders.forEach(order => {
                const orderDiv = document.createElement('div');
                orderDiv.className = 'order-card';
                
                orderDiv.innerHTML = `
                    <h4><span class="order-id">${order.id}</span> - ${order.requestorName}</h4>
                    <p><strong>Shop:</strong> ${order.shopId} ‚Ä¢ ${order.region} ‚Ä¢ ${order.storeStatus}</p>
                    <p><strong>Contact:</strong> ${order.contactNumber}</p>
                    <p><strong>Address:</strong> ${order.address}</p>
                    <p><strong>Date Needed:</strong> ${order.dateNeeded}</p>
                    <p><strong>Date Requested:</strong> ${order.date}</p>
                    <p><strong>Materials:</strong> ${order.items.map(item => `${item.name} (x${item.quantity})`).join(', ')}</p>
                    <p><strong>Total Items:</strong> ${order.items.reduce((sum, item) => sum + item.quantity, 0)}</p>
                    ${order.notes ? `<p><strong>Notes:</strong> ${order.notes}</p>` : ''}
                    <p><strong>Status:</strong> 
                        <span class="status ${order.status}">${order.status.toUpperCase()}</span>
                        <select onchange="updateOrderStatus('${order.id}', this.value)" style="margin-left: 10px; padding: 8px; border-radius: 6px; border: 2px solid #ddd;">
                            <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>Processing</option>
                            <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>Approved</option>
                            <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Delivered</option>
                            <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                        </select>
                    </p>
                    <button onclick="viewOrderDetails('${order.id}')">View Details</button>
                `;
                orderList.appendChild(orderDiv);
            });
        }

        async function updateOrderStatus(orderId, newStatus) {
            const order = orders.find(o => o.id === orderId);
            if(order) {
                const oldStatus = order.status;
                order.status = newStatus;
                
                try {
                    const { error } = await supabase
                        .from('orders')
                        .update({ status: newStatus })
                        .eq('order_id', orderId);
                    
                    if (error) throw error;
                    
                    if(newStatus === 'cancelled' && oldStatus !== 'cancelled') {
                        order.items.forEach(orderItem => {
                            const item = items.find(i => i.id == orderItem.itemId);
                            if(item) item.stock += orderItem.quantity;
                        });
                    }
                    
                    saveLocalData();
                    displayOrdersAdmin();
                    displayCustomerOrders();
                    displayStoreItems();
                } catch (error) {
                    console.error('Error updating order status:', error);
                    alert('Error updating order status in database');
                }
            }
        }

        function searchAdminOrders() {
            const searchTerm = document.getElementById('adminOrderSearch').value.toLowerCase();
            const orderDivs = document.querySelectorAll('#orderList .order-card');
            
            orderDivs.forEach(div => {
                const text = div.textContent.toLowerCase();
                div.style.display = text.includes(searchTerm) ? 'block' : 'none';
            });
        }

        function exportToExcel(dataType) {
            let data, filename, worksheetName;
            
            if(dataType === 'items') {
                data = items.map(item => ({
                    'ID': item.id,
                    'Material Name': item.name,
                    'Category': item.category,
                    'Stock': item.stock,
                    'Description': item.description || '',
                    'Date Added': item.dateAdded || new Date().toLocaleDateString()
                }));
                filename = 'infx_materials_export.xls';
                worksheetName = 'Materials';
            } else if(dataType === 'orders') {
                data = orders.map(order => ({
                    'Request ID': order.id,
                    'Requestor Name': order.requestorName,
                    'User ID': order.userId,
                    'Shop ID': order.shopId,
                    'Contact Number': order.contactNumber,
                    'Address': order.address,
                    'Store Status': order.storeStatus,
                    'Region': order.region,
                    'Date Needed': order.dateNeeded,
                    'Request Date': order.date,
                    'Status': order.status,
                    'Notes': order.notes || '',
                    'Items Count': order.items.length,
                    'Total Items': order.items.reduce((sum, item) => sum + item.quantity, 0),
                    'Materials': order.items.map(item => `${item.name} (x${item.quantity})`).join('; ')
                }));
                filename = 'infx_requests_export.xls';
                worksheetName = 'Requests';
            }
            
            if(!data || data.length === 0) {
                alert('No data to export!');
                return;
            }
            
            const headers = Object.keys(data[0]);
            let html = `
                <html xmlns:o="urn:schemas-microsoft-com:office:office" 
                      xmlns:x="urn:schemas-microsoft-com:office:excel" 
                      xmlns="http://www.w3.org/TR/REC-html40">
                <head>
                    <meta charset="UTF-8">
                    <title>${worksheetName}</title>
                    <style>
                        td { padding: 5px; border: 1px solid #ddd; }
                        th { background: var(--main-green); color: white; padding: 10px; border: 1px solid #ddd; }
                    </style>
                </head>
                <body>
                    <table>
                        <thead><tr>
            `;
            
            headers.forEach(header => html += `<th>${header}</th>`);
            html += `</tr></thead><tbody>`;
            
            data.forEach(row => {
                html += '<tr>';
                headers.forEach(header => html += `<td>${row[header] || ''}</td>`);
                html += '</tr>';
            });
            
            html += `</tbody></table></body></html>`;
            
            const blob = new Blob([html], { type: 'application/vnd.ms-excel' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert(`Data exported as ${filename}!`);
        }

        function backupData() {
            const backup = {
                items: items,
                orders: orders,
                categories: categories,
                orderCounter: orderCounter,
                backupDate: new Date().toLocaleString()
            };
            
            const dataStr = JSON.stringify(backup, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            
            link.setAttribute('href', url);
            link.setAttribute('download', `infx_backup_${new Date().toISOString().split('T')[0]}.json`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('Backup created successfully!');
        }

        function updateStoreLink() {
            const link = window.location.href.split('?')[0];
            document.getElementById('storeLink').value = link;
        }

        function copyStoreLink() {
            const linkInput = document.getElementById('storeLink');
            linkInput.select();
            linkInput.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(linkInput.value);
            alert('System link copied to clipboard!');
        }

        function getLocalItems() {
            const localItems = JSON.parse(localStorage.getItem('infxItems'));
            if (localItems && localItems.length > 0) {
                return localItems;
            }
            return [
                { id: 1, name: "Infinix Branded T-Shirts", category: "Marketing Materials", stock: 50, description: "Various sizes available" },
                { id: 2, name: "Counter Display Unit", category: "Display Units", stock: 10, description: "Floor standing display" },
                { id: 3, name: "Poster Set", category: "POS Materials", stock: 100, description: "Set of 5 promotional posters" },
                { id: 4, name: "Branded Pens", category: "Stationery", stock: 200, description: "Infinix logo pens" },
                { id: 5, name: "Promotional Flyers", category: "Marketing Materials", stock: 500, description: "A4 size, full color" },
                { id: 6, name: "Banner Stand", category: "Display Units", stock: 15, description: "Roll-up banner" },
                { id: 7, name: "Price Cards", category: "POS Materials", stock: 300, description: "Cardstock price displays" }
            ];
        }

        function getLocalCategories() {
            const localCats = JSON.parse(localStorage.getItem('infxCategories'));
            if (localCats && localCats.length > 0) {
                return localCats;
            }
            return [
                "Marketing Materials",
                "Display Units",
                "POS Materials",
                "Branding Items",
                "Promotional Tools",
                "Equipment",
                "Stationery"
            ];
        }

        function getLocalOrders() {
            return JSON.parse(localStorage.getItem('infxOrders')) || [];
        }

        function saveLocalData() {
            localStorage.setItem('infxItems', JSON.stringify(items));
            localStorage.setItem('infxCart', JSON.stringify(cart));
            localStorage.setItem('infxOrders', JSON.stringify(orders));
            localStorage.setItem('infxOrderCounter', orderCounter.toString());
            localStorage.setItem('infxCategories', JSON.stringify(categories));
        }

        // ==============================================
        // INITIALIZE APP
        // ==============================================

        async function initializeApp() {
            try {
                // Load data from Supabase
                items = await loadItemsFromSupabase();
                categories = await loadCategoriesFromSupabase();
                orders = await loadOrdersFromSupabase();
                
                // Initialize UI
                initializeCategoryDropdown();
                displayStoreItems();
                updateCartCount();
                displayCategoriesAdmin();
                updateStoreLink();
                updateHomeStats();
                
                // Save local backup
                saveLocalData();
                
            } catch (error) {
                console.error('Error initializing app:', error);
                // Fallback to local data
                items = getLocalItems();
                categories = getLocalCategories();
                orders = getLocalOrders();
                orderCounter = parseInt(localStorage.getItem('infxOrderCounter')) || 1;
                
                initializeCategoryDropdown();
                displayStoreItems();
                updateCartCount();
                displayCategoriesAdmin();
                updateStoreLink();
                updateHomeStats();
            }
        }

        window.onload = initializeApp;
    </script>
</body>
</html>